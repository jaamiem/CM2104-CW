<!DOCTYPE html>
<html lang="en">
<%- include('partials/header') %>
<body>
<%- include('partials/navbar') %>

<!-- Map Display Div -->
<nav class="navbar-primary">
	<div class="sidebtn">
		<a href='#' class="btn-expand-collapse"><span class="glyphicon glyphicon-menu-left"></span></a>
	</div>
	<div class="sidebar">
		<ul class="navbar-primary-menu">
			<li>
				<a href="#"><span class="nav-label">LINK 1</span></a>
				<a href="#"><span class="nav-label">LINK 2</span></a>
				<a href="#"><span class="nav-label">LINK 3</span></a>
			</li>
		</ul>
	</div>
</nav>

<script>
	$('.btn-expand-collapse').click(function(e) {
		$('.navbar-primary').toggleClass('collapsed');
	});
</script>

<div id="map" ng-app="FindSpotApp">
	<!-- <%- JSON.stringify(spots) %> -->
	<!-- <noscript><p>Unfortunately, we haven't been able to load Google Maps.</p></noscript> -->
</div>

<script>
var spots = <%- JSON.stringify(spots) %>;
JSON.parse(spots);
// document.getElementById('ma1p').innerHTML = spots;
// var spots = <%= spots %>;



function initMap() {
	var abz = {lat:57.1497, lng:-2.0943};
	var infowindow = new google.maps.InfoWindow;

	var contentString = "nae string \'ere just yet pal";

	var map = new google.maps.Map(document.getElementById('map'), {
		zoom: 12,
		center: abz,
		mapTypeControl: false
	});
	map.setTilt(45);

	// var marker = new google.maps.Marker({
	// 	position: new google.maps.LatLng(spots.default[0].lat, spots.default[0].lng),
	// 	map: map
	// });
	var marker,i;
	var markedSpots,contentStrings = [];

	for ( i = 0; i < Object.keys(spots.default).length; i++ ) {
		marker = new google.maps.Marker({
			position: new google.maps.LatLng(spots.default[i].lat, spots.default[i].lng),
			map: map,
			id: i
		});
		var contentMap = '<div id="infoContent">'+
			'<h5 id="locHeading">' + spots.default[i].name + '</h1></div>'+
			'<p id="locInfo">Type:' + spots.default[i].type  + '</p>'+
			'<p id="locInfo">additional info: ' + spots.default[i].rating + '</p>';

		contentStrings[i] = contentMap;

		google.maps.event.addListener(marker, 'click', (function(marker, i) {
			return function() {
				map.setZoom(16);
				map.setCenter(marker.getPosition());
				infowindow.setContent(contentStrings[i]);
				infowindow.open(map,marker);
			}
		})(marker,i));

		// markedSpots.push(marker);

		// marker.addListener('click', function() {
		// 	map.setZoom(16);
		// 	map.setCenter(marker.getPosition());
		// 	infowindow.setContent(contentString);
		// 	infowindow.open(map,marker);
		// });
	}

}


</script>

<!-- Import Google Map API -->
<script defer
  src="https://maps.googleapis.com/maps/api/js?key=AIzaSyDRK2xpbDf14zS08cMkp252N8uPvt3O4_I&callback=initMap">
</script>

</body>
</html>
